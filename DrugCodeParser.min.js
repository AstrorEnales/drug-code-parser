(function(){"use strict";function s(t){this.message=t,this.name="ParseException"}var n=function(){};n.validatePPN=function(t){if(void 0===t||12!==t.length)return!1;for(var r=0,e=0;e<t.length-2;e++)r+=(e+2)*t.charAt(e).charCodeAt(0);return r%97===parseInt(t.substring(t.length-2),10)},n.validatePZN=function(t){if(void 0===t||7!==t.length&&8!==t.length)return!1;for(var r=9-t.length,e=0,i=0;i<t.length-1;i++)e+=(i+r)*parseInt(t.charAt(i),10);return e%11===parseInt(t.substring(t.length-1),10)},n.parseIFAPPN=function(t){if(void 0===t||t.length<8)throw new s("The text is not a valid IFA PPN code (text is too short).");if(!t.startsWith("[)>")||30!==t.charCodeAt(3))throw new s("The text is not a valid IFA PPN code (prefix mismatch).");var i,r=t.indexOf(String.fromCharCode(30)+String.fromCharCode(4)),e=t.substring(4,r).split(String.fromCharCode(29));if("06"!==e[0])throw new s("The text is not a valid IFA PPN code.");return i={},e.slice(1).forEach(function(t){if(t.startsWith("9N")){var r=t.substring(2),e=r.substring(2,r.length-2);i.ppn={value:r,valid:n.validatePPN(r)},i.pzn={value:e,valid:n.validatePZN(e)}}else t.startsWith("1T")?i.batch=t.substring(2):t.startsWith("D")?(i.expirationDate="20"+t.substring(1,3)+"-"+t.substring(3,5),"00"!==t.substring(5,7)&&(i.expirationDate+="-"+t.substring(5,7))):t.startsWith("16D")?(i.productionDate=t.substring(3,7)+"-"+t.substring(7,9),"00"!==t.substring(9,11)&&(i.productionDate+="-"+t.substring(9,11))):t.startsWith("S")?i.serial=t.substring(1):t.startsWith("8P")&&(i.gtin=t.substring(2))}),i},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=n),exports.DrugCodeParser=n):this.DrugCodeParser=n}).call(this);